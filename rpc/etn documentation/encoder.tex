\section*{Encoder}
\emph{EtnEncoder} is a \lq\lq writer" and can be considered a base class. This data structure contains two function pointers, a \emph{red-black tree} and an index.\\
The two function pointers are one to a \emph{write} function and one to a \emph{flush} function. The actual implementations of both are declared in the header file \emph{packetEncoder.h} and defined in file \emph{packetEncoder.c}.\\
The \emph{write} function  writes data to a packet sending fragments as maximum size reached. The final (non-full) fragment is not sent because there may be remaining data to write to it.\\
The \emph{flush} function flushes packet encoder, sending the packet as the final fragment. Note that if the write does not fill the first fragment, then nothing will be sent until flush is called.
The \emph{red-black tree} structure is used to 























\begin{comment}
// The parent encoder class.
typedef struct EtnEncoder_s {
	int (*write)(struct EtnEncoder_s *e, uint8_t *data, EtnLength length);
	void (*flush)(struct EtnEncoder_s *e);
	void *topLevelPointer; // See comments in encoder.c.
	struct rbtree addrToIndex;
	EtnLength index;
} EtnEncoder;

// Encoder subclass that encodes to provided memory range.
typedef struct EtnBufferEncoder_s {
	EtnEncoder encoder;
	uint8_t *dataCurrent;
	uint8_t *dataEnd;
} EtnBufferEncoder;

// Encoder subclass that throws away encoded data;
// useful to determine what size of encoded data will be.
typedef struct EtnNullEncoder_s {
	EtnEncoder encoder;
} EtnNullEncoder;
\end{comment}
